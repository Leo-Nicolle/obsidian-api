<!DOCTYPE html>

<html>

    <head>
        <meta charset="UTF-8" />
        <title>README.md - Obsidian API</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        
            <link rel="shortcut icon" type="image/png" href="images/obsidian-api-logo.svg" />
        
        
            <link type="text/css" rel="stylesheet" href="style/abitbol.css" />
        
            <link type="text/css" rel="stylesheet" href="style/gruvbox-dark.css" />
        
    </head>

    <body class=" page-with-nav">

        <div class="page">

            
                <div id="toggle-mobile-menu" title="Toggle menu">â˜°</div>
            

            
                <nav class="links">
                    <ul>
                        <li><a href="https://github.com/wanadev/obsidian-api">Github</a></li><li><a href="https://www.npmjs.com/package/obsidian-api">NPM</a></li>
                    </ul>
                </nav>
            

            <header>
                <h1>
                    
                        <img src="images/obsidian-api-logo.svg"  alt="Obsidian API logo" />
                    
                    <span>Obsidian API</span>
                </h1>
            </header>

            <div class="content">

                
                    <nav>
                        
                            

    <ul class="menu">
        
            
            <li>
                <a href="README.html" class="active">README.md</a>
                
            </li>
        
            
            <li>
                <a href="index.html" >Home</a>
                
            </li>
        
            
            <li>
                <a href="application-side-api.html" >Application-Side API</a>
                
            </li>
        
            
            <li>
                <a href="integration-side-api.html" >Integration-Side API</a>
                
            </li>
        
            
            <li>
                <a href="example.html" >Example</a>
                
            </li>
        
    </ul>


                        
                    </nav>
                
                <article>
                    <h1 id="obsidian-api">Obsidian API</h1>
<p><a href="https://travis-ci.org/wanadev/obsidian-api"><img src="https://travis-ci.org/wanadev/obsidian-api.svg?branch=master" alt="Build Status"></a>
<a href="https://www.npmjs.com/package/obsidian-api"><img src="http://img.shields.io/npm/v/obsidian-api.svg?style=flat" alt="NPM Version"></a>
<a href="https://github.com/wanadev/obsidian-api/blob/master/LICENSE"><img src="http://img.shields.io/npm/l/obsidian-api.svg?style=flat" alt="License"></a>
<a href=""><img src="https://img.shields.io/david/wanadev/obsidian-api.svg?maxAge=2592000" alt="Dependencies"></a>
<a href=""><img src="https://img.shields.io/david/dev/wanadev/obsidian-api.svg?maxAge=2592000" alt="Dev Dependencies"></a></p>
<p>This module provides a way to implement integration API (to communicate between the integration page and the application iframe).</p>
<p>Features:</p>
<ul>
<li>Remote method calls with response (integration -&gt; app -&gt; integration)</li>
<li>Provides callback-based events (app -&gt; integration)</li>
<li>Allows the integration to send configuration to the app</li>
<li>Allows to transfer of various types of objects (including <code>TypedArrays</code>, <del><code>Blob</code></del> and <del><code>Buffer</code></del> TODO)</li>
<li>Allows to use both node-like callbacks or promises for async calls</li>
</ul>
<h2 id="app-side-example">App-side example</h2>
<pre><code class="hljs javascript"><span class="hljs-meta">"use strict"</span>;

<span class="hljs-keyword">var</span> ObsidianApi = <span class="hljs-built_in">require</span>(<span class="hljs-string">"obsidian-api"</span>);


<span class="hljs-keyword">var</span> MyApi = ObsidianApi.$extend({

    <span class="hljs-attr">simpleMethod</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">a, b</span>) </span>{
        <span class="hljs-string">"@api"</span>;                                                   <span class="hljs-comment">// allows to call this method from the integration side</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> a != <span class="hljs-string">"number"</span> || <span class="hljs-keyword">typeof</span> b != <span class="hljs-string">"number"</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"NotANumber"</span>);
        }
        <span class="hljs-keyword">return</span> a + b;                                             <span class="hljs-comment">// return of a simple result (will be passed as return</span>
                                                                  <span class="hljs-comment">// value to the integration-side caller)</span>
    },

    <span class="hljs-attr">asyncMethodUsingCallback</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">a, b, callback</span>) </span>{          <span class="hljs-comment">// callback = function(error, result) {}</span>
        <span class="hljs-string">"@api"</span>;
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> a != <span class="hljs-string">"number"</span> || <span class="hljs-keyword">typeof</span> b != <span class="hljs-string">"number"</span>) {
            callback(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"NotANumber"</span>));
        } <span class="hljs-keyword">else</span> {
            callback(<span class="hljs-literal">null</span>, a + b);                                <span class="hljs-comment">// null as first param means "no error"</span>
        }
    },

    <span class="hljs-attr">asyncMethodUsingPromise</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">a, b</span>) </span>{
        <span class="hljs-string">"@api"</span>;
        <span class="hljs-keyword">var</span> promise = sommeFunctionThatReturnsAPromise(a, b);
        <span class="hljs-keyword">return</span> promise;                                           <span class="hljs-comment">// by returning a promise, the API will wait for the promise</span>
                                                                  <span class="hljs-comment">// to be resolved and then return the result to the integration</span>
    }
});


<span class="hljs-comment">// Get the configuration provided by the integration</span>
<span class="hljs-keyword">var</span> config = MyApi.$getConfig();


<span class="hljs-comment">// Instanciate the API</span>
<span class="hljs-keyword">var</span> api = <span class="hljs-keyword">new</span> MyApi();


<span class="hljs-comment">// Hot plug of new API methods (allows components to dynamicaly extend the API)</span>
api.addApiMethod(<span class="hljs-string">"myMethod"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{});


<span class="hljs-comment">// Tells the integration that the app is ready</span>
api.ready();


<span class="hljs-comment">// Send an event to the integration</span>
api.sendEvent(<span class="hljs-string">"eventName"</span>, <span class="hljs-string">"param1"</span>, <span class="hljs-string">"param2"</span>);</code></pre>


<h2 id="integration-side-example">Integration-side example</h2>
<pre><code class="hljs javascript"><span class="hljs-keyword">var</span> obsidianApp = <span class="hljs-built_in">require</span>(<span class="hljs-string">"obsidian-api/lib/integration"</span>);

<span class="hljs-comment">// Start the application</span>
<span class="hljs-keyword">var</span> app = obsidianApp({
    <span class="hljs-attr">htmlNode</span>: <span class="hljs-string">"#integration-div"</span>,              <span class="hljs-comment">// Query selector or HTMLElement that will be the parent of the iframe</span>
    appUrl: <span class="hljs-string">"http://example.com/"</span>,             <span class="hljs-comment">// The URL of the application</span>
    config: {}                                 <span class="hljs-comment">// Optional config that will be passed to the application</span>
});


<span class="hljs-comment">// Do stuff when the application is ready</span>
app.on(<span class="hljs-string">"ready"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{

    <span class="hljs-comment">// Call remote methods (using node-like callbacks to get the response)</span>

    app.simpleMethod(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">error, result</span>) </span>{
        <span class="hljs-built_in">console</span>.log(result);   <span class="hljs-comment">// -&gt; 3</span>
    });

    app.asyncMethodUsingCallback(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">error, result</span>) </span>{
        <span class="hljs-built_in">console</span>.log(result);   <span class="hljs-comment">// -&gt; 3</span>
    });

    <span class="hljs-comment">// Call a remote method using promises to get the result</span>

    app.simpleMethod(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>)
        .then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">result</span>) </span>{
            <span class="hljs-built_in">console</span>.log(result);  <span class="hljs-comment">// -&gt; 3</span>
        })
        .catch(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">error</span>) </span>{
            <span class="hljs-built_in">console</span>.error(error);
        });
});


<span class="hljs-comment">// Register a callback to an API event</span>
app.on(<span class="hljs-string">"eventName"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">param1, param2</span>) </span>{
    <span class="hljs-comment">// do stuff here...</span>
});</code></pre>


<h2 id="changelog">Changelog</h2>
<ul>
<li><strong>1.0.3:</strong> Updates dependencies</li>
<li><strong>1.0.2:</strong> Fixes Node.js Buffer transfer</li>
<li><strong>1.0.1:</strong> Updates dependencies</li>
<li><strong>1.0.0:</strong> First public release</li>
</ul>

                </article>
            </div>

            <footer>
                Copyright (c)  2015-2017 Wanadev
- <a href="http://www.wanadev.fr/">www.wanadev.fr</a><br />
Unless otherwise specified, this documentation is published under the
<a href="http://creativecommons.org/licenses/by-sa/3.0/deed.en">cc by-sa 3.0</a> license<br />
Generated using <a href="https://wanadev.github.io/enlightme/\">Enlight'me</a> 0.1.1

            </footer>

        </div>

        <script>

(function() {

    var MENU_UNFOLDED_CLASS = "mobile-menu-unfolded";

    var menuButton = document.getElementById("toggle-mobile-menu");
    var menuItems = document.querySelectorAll(".content nav a");

    function getAbsolutePosition(element) {
        if (typeof(element) == "string") {
            element = document.getElementById(element);
        }
        if (!(element instanceof Element)) {
            return {x: 0, y: 0};
        }

        var css;
        var origElement = element;

        try {
            css = getComputedStyle(element);
        } catch (e) {
            return {x: 0, y: 0};
        }

        if (!css) {
            return {x: 0, y: 0};
        }

        var x = -parseInt(css.borderLeftWidth);
        var y = -parseInt(css.borderTopWidth);

        while (element.offsetParent) {
            css = getComputedStyle(element);

            x += element.offsetLeft || 0;
            x += parseInt(css.borderLeftWidth);

            y += element.offsetTop || 0;
            y += parseInt(css.borderTopWidth);

            element = element.offsetParent;
        }

        element = origElement;

        while (element.parentNode && !(element instanceof HTMLBodyElement)) {
            x -= element.scrollLeft || 0;
            y -= element.scrollTop || 0;
            element = element.parentNode;
        }

        return {x: x, y: y};
    };

    function openMenu() {
        document.body.classList.add(MENU_UNFOLDED_CLASS);
    }

    function closeMenu() {
        document.body.classList.remove(MENU_UNFOLDED_CLASS);
    }

    function toggleMenu() {
        document.body.classList.toggle(MENU_UNFOLDED_CLASS);
    }

    function _onMenuItemClicked(event) {
        var href = this.getAttribute("href");

        if (href[0] != "#") {
            return;
        }

        event.preventDefault();

        var anchor = href.substr(1, href.length-1);
        var anchorPosition = getAbsolutePosition(anchor);
        document.scrollingElement.scrollTop = anchorPosition.y - menuButton.offsetHeight;

        closeMenu();
    }

    menuButton.onclick = toggleMenu;
    menuItems.forEach(function(item) {
        item.onclick = _onMenuItemClicked;
    });

})();

</script>

    </body>

</html>
